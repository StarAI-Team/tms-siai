<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auction Room</title>
    <link rel="stylesheet" href="/static/css/bid.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="auction-room">
        <!-- Left Image Side -->
        <div class="image-side"></div>

        <!-- Right Content Side -->
        <div class="container">
            <h1>Auction Room</h1>

            <div class="auction-card">
                <div class="auction-details">
                    <h2>{{ load_name }}</h2>
                    <p><strong>Load:</strong> {{ load_name }}</p>
                    <p><strong>Quantity:</strong> {{ quantity }}</p>
                    <p><strong>Route:</strong> {{ route }}</p>
                    <p><strong>Rate:</strong> ${{ rate }}</p>
                    <p><strong>Payment Duration:</strong> 60 Days</p>
                    <p><strong>Truck Type and Number:</strong> 10 tanker</p>
                </div>

                <!-- Show Perfect Match star if applicable -->
                {% if perfect_match %}
                <div class="star-flashing">
                    <div class="star">Perfect Match!</div>
                </div>
                {% endif %}
            </div>
            <!-- "Check out" Text with White Border -->
            <div class="view-text-container">
                <div class="view-text">
                    Check Out What The Other Transporters are bidding
                </div>
            </div>

            <!-- Bids -->
            <div class="bids">
                <div class="bid-view">$1400</div>
                <div class="bid-view">$1200</div>
                <div class="bid-view">$1300</div>
                <div class="bid-view">$1100</div>
                <div class="bid-view">$900</div>
            </div>

            <!-- User Offer Input -->
            <div class="offer-container">
                <input type="number" id="offer-input" placeholder="Your Offer" />
            </div>            
            <input type="text" class="addon-input" placeholder="AddOns e.g. I can pay for your customs clearance fee">

            <!-- Action Buttons -->
            <div class="buttons">
                <button class="back-button" onclick="window.location.href='/bid'"> Back</button>
                <button class="bid-button">Bid</button>
            </div>
        </div>
    </div>
    <script>
        document.querySelector('.bid-button').addEventListener('click', function() {
            
            const offer = document.getElementById('offer-input').value;
            const addons = document.querySelector('.addon-input').value;

             // Fetch user metadata
             fetch('/get_user_metadata')
                    .then(response => response.json())
                    .then(metadata => {
                        const payload = {
                            event_name: 'Bid_Made',
                            user_id: metadata.user_id,
                            ip_address: metadata.ip_address,
                            timestamp: new Date().toISOString(),
                            user_agent: navigator.userAgent,
                            offer: offer,
                            addons: addons,
                            form_data: {
                                load_name: "{{ load_name }}",
                                quantity: "{{ quantity }}",
                                route: "{{ route }}",
                                rate: "{{ rate }}"
                            }
                        };
        
            // Send the data using Fetch API
            fetch('/place_bid_done', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                alert('Bid placed successfully!')
                
            })
            .catch((error) => {
                console.error('Error:', error);
                
            });
        });
    });
    </script>
        
</body>
</html>

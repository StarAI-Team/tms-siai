<!DOCTYPE html>
<html>
<head>
    <title>Package Selected</title>
    <link rel="stylesheet" href="/static/css/payment_package.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="package-box">
            <div class="package-info">
                <h2 id="package-name">Package Name</h2>
                <p id="package-price">$0</p>
            </div>
        </div>

        <!-- Payment Method Selection -->
        <div class="package-box2">
            <div id="select-payment-method">Select Payment Method</div>
                <div class="payment-methods">
                    <!-- Mobile Payment Icons -->
                <a href="#" class="payment-option" data-method="omari"><img src="/static/images/omari.webp" alt="O'mari"></a>
                <a href="#" class="payment-option" data-method="ecocash"><img src="/static/images/ecocash.png" alt="EcoCash"></a>
                <a href="#" class="payment-option" data-method="1money"><img src="/static/images/1money.png" alt="OneMoney"></a>
                <a href="#" class="payment-option" data-method="innbucks"><img src="/static/images/innbucks.png" alt="InnBucks"></a>
            </div>

            <div class="payment-methods">
                <!-- Card Payment Icons -->
            <a href="#" class="payment-option" data-method="visa"><img src="/static/images/visa-logo-visa-icon-free-free-vector.jpg" alt="VISA"></a>
            <a href="#" class="payment-option" data-method="mastercard"><img src="/static/images/Mastercard_new_logo-1200x865.webp" alt="MasterCard"></a>
            <a href="#" class="payment-option" data-method="zimswitch"><img src="/static/images/zimswitch.jpeg" alt="ZimSwitch"></a>
        </div>

            <!-- Hidden Payment Details Form -->
            <div id="payment-form" class="payment-form" style="display:none;">
                <div id="mobile-payment" style="display:none;">
                    <h3>Mobile Payment</h3>
                    <input type="text" id="phone-number" placeholder="Enter Phone Number">
                    <input type="password" id="pin" placeholder="Enter PIN">
                </div>

                <div id="card-payment" style="display:none;">
                    <h3>Card Payment</h3>
                    <input type="text" id="card-number" placeholder="Enter Card Number">
                    <input type="password" id="cvv" placeholder="Enter CVV">
                </div>

                <!-- Submit Payment Button -->
                <button id="submit-payment-button" class="button">Submit </button>
            </div>
        </div>
    </div>

    <<script>
        // Get query parameters from the URL
        const urlParams = new URLSearchParams(window.location.search);
        const selectedPackage = urlParams.get('package');
        const selectedAmount = urlParams.get('amount');

        // Set the package name and price dynamically
        document.getElementById('package-name').textContent = selectedPackage;
        document.getElementById('package-price').textContent = selectedAmount ? `$${selectedAmount}` : '$0';

        // Payment Method Selection Logic
        const paymentOptions = document.querySelectorAll('.payment-option');
        const paymentForm = document.getElementById('payment-form');
        const mobilePayment = document.getElementById('mobile-payment');
        const cardPayment = document.getElementById('card-payment');

        paymentOptions.forEach(option => {
            option.addEventListener('click', function(e) {
                e.preventDefault();
                const method = this.getAttribute('data-method');
                
                // Show the payment form
                paymentForm.style.display = 'block';

                // Reset visibility
                mobilePayment.style.display = 'none';
                cardPayment.style.display = 'none';

                // Show corresponding payment inputs
                if (method === 'visa' || method === 'mastercard' || method ==='zimswitch') {
                    cardPayment.style.display = 'block';
                } else {
                    mobilePayment.style.display = 'block';
                }
            });
        });

        // Handle payment submission
        document.getElementById('submit-payment-button').addEventListener('click', function() {
            // Simple validation
            if (mobilePayment.style.display === 'block') {
                const phoneNumber = document.getElementById('phone-number').value;
                const pin = document.getElementById('pin').value;
                if (!phoneNumber || !pin) {
                    alert('Please enter phone number and PIN for mobile payment.');
                    return;
                }
            } else if (cardPayment.style.display === 'block') {
                const cardNumber = document.getElementById('card-number').value;
                const cvv = document.getElementById('cvv').value;
                if (!cardNumber || !cvv) {
                    alert('Please enter card number and CVV for card payment.');
                    return;
                }
            }

            // Handle payment submission
document.getElementById('submit-payment-button').addEventListener('click', function() {
    // Simple validation
    if (mobilePayment.style.display === 'block') {
        const phoneNumber = document.getElementById('phone-number').value;
        const pin = document.getElementById('pin').value;
        if (!phoneNumber || !pin) {
            alert('Please enter phone number and PIN for mobile payment.');
            return;
        }
    } else if (cardPayment.style.display === 'block') {
        const cardNumber = document.getElementById('card-number').value;
        const cvv = document.getElementById('cvv').value;
        if (!cardNumber || !cvv) {
            alert('Please enter card number and CVV for card payment.');
            return;
        }
    }

    // Handle form submission
    const form = document.getElementById('payment-form'); // Assuming you have a form element here
    form.addEventListener('submit', function (e) {
        e.preventDefault(); // Prevent the default form submission
        if (validateFormStep()) { // You should implement this function based on your requirements
            const formData = new FormData(form);

            // Creating a custom event with a single event name
            const formSubmissionEvent = new CustomEvent('transporterRegistration', {
                detail: {
                    formData: formData,
                    formId: form.id // Optional: Pass the form ID
                }
            });
            // Dispatch the custom event
            document.dispatchEvent(formSubmissionEvent);

            // Send form data to the server
            fetch('http://127.0.0.1:8000/register_transporter', {
                method: 'POST',
                body: formData,
            })            
            .then(response => response.json())
            .then(data => {
                if (data.error === "Missing fields") {
                    alert(`Error: Missing fields: ${data.fields.join(', ')}`);
                } else {
                    alert('Form submitted successfully!');
                    form.reset();
                    currentStep = 0;  // Reset to the first step after successful submission
                    showStep(currentStep);  // Show the first step
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        } else {
            showErrorMessage('Please fix the errors before submitting.'); // You should implement this function based on your requirements
        }
    });

    // Trigger form submission event
    form.dispatchEvent(new Event('submit'));
});

            // Redirect to register after a short delay
            setTimeout(() => {
                window.location.href = '/welcome-transporter';
            }, 1000);
        });
    </script>
</body>
</html>
